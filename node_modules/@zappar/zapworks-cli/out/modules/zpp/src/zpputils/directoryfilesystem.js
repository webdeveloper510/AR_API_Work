"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.DirectoryFileSystemReader = exports.DirectoryFileSystemWriter = void 0;
const path = require("path");
const fs = require("fs-extra");
class DirectoryFileSystemWriter {
    constructor(dir) {
        this._filesByPath = {};
        this._baseDir = dir;
    }
    async putFile(filename, contents) {
        this._filesByPath[filename] = contents;
    }
    async _saveFile(filename, contents) {
        let finalPath = path.join(this._baseDir, filename);
        let directory = path.dirname(finalPath);
        await fs.mkdirp(directory);
        await fs.writeFile(finalPath, contents);
    }
    async save() {
        let promises = [];
        for (let k in this._filesByPath) {
            let contents = this._filesByPath[k];
            promises.push(this._saveFile(k, contents));
        }
        await Promise.all(promises);
    }
}
exports.DirectoryFileSystemWriter = DirectoryFileSystemWriter;
class DirectoryFileSystemReader {
    constructor(dir) {
        this._baseDir = dir;
    }
    async getFile(filename) {
        let fullPath = path.join(this._baseDir, filename);
        return await fs.readFile(fullPath);
    }
}
exports.DirectoryFileSystemReader = DirectoryFileSystemReader;
